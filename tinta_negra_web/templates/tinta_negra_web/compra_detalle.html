{% extends 'core/base.html' %}
{% load static %}

{% block content %}

<h1 class="text-white mt-4">Detalle de Compra #{{ compra.id_compra }}</h1>

<div class="card p-4 mb-4 bg-dark text-white">
    <div class="row">
        <div class="col-md-6">
            <h5 class="mb-3">Datos Generales</h5>
            <p><strong>Proveedor:</strong> {{ compra.proveedor.nombre }}</p>
            <p><strong>Empleado que registra:</strong> {{ compra.empleado.nombre }}</p>
            <p><strong>Fecha de registro:</strong> {{ compra.fecha|date:"Y-m-d H:i" }}</p>
        </div>
        <div class="col-md-6">
            <h5 class="mb-3">Informaci칩n Financiera</h5>
            <p><strong>Total de la Compra:</strong> <span class="badge bg-success">${{ compra.total|floatformat:2 }}</span></p>
            {# Asumiendo que la forma de pago est치 en el movimiento de caja o la a침ades a Compras model #}
            <p><strong>Forma de Pago:</strong> N/A (Se busca en el Movimiento de Caja)</p>
        </div>
    </div>
    
    <hr class="text-white-50">

    <h5 class="mt-4 mb-3">Detalle de Insumos Adquiridos</h5>
    
    <div class="table-responsive">
        <table class="table table-dark table-striped">
            <thead>
                <tr>
                    <th>Insumo</th>
                    <th>Cantidad</th>
                    <th>Precio Unitario</th>
                    <th>Subtotal</th>
                </tr>
            </thead>
            <tbody>
                {% for detalle in detalles %}
                    <tr>
                        <td>{{ detalle.insumo.nombre }}</td>
                        <td>{{ detalle.cantidad }}</td>
                        <td>${{ detalle.precio_unitario|floatformat:2 }}</td>
                        {# Calculamos el subtotal en el template para visualizaci칩n #}
                        <td>${{ detalle.cantidad|times:detalle.precio_unitario|floatformat:2 }}</td>
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="4" class="text-center">Esta compra no tiene detalles de insumos registrados.</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

</div>

<div class="d-flex justify-content-start mt-4">
    <a href="{% url 'compras_list' %}" class="btn btn-secondary">
        <i class="fas fa-arrow-left"></i> Volver a la Lista
    </a>
</div>

{% endblock %}
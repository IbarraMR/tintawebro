{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"/>
    <meta http-equiv="Pragma" content="no-cache"/>
    <meta http-equiv="Expires" content="0"/>

    <title>Tinta Negra | {% block title %}{% endblock %}</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link rel="stylesheet" href="{% static 'core/css/styles.css' %}">
</head>
<body>

{% if user.is_authenticated %}
<header class="main-header bg-dark text-white py-2 px-3 d-flex align-items-center">
    <a class="navbar-brand" href="{% url 'home' %}">
        <img src="{% static 'core/logoTintaBlanco.png' %}" alt="TINTA NEGRA" style="height: 50px;">
    </a>
</header>
{% endif %}

<div class="main-layout d-flex">

{% if user.is_authenticated %}
<nav class="sidebar d-flex flex-column justify-content-between p-3"
     style="min-height: 100vh; width: 240px; background-color: #1c1c1c;">

    <style>
        .submenu-item { padding-left: 18px; font-size: 0.9rem; }
        .submenu-item i { font-size: 0.75rem !important; }
    </style>

    <div>
        <div class="sidebar-user text-white mb-3">
            <strong>Hola {{ request.user.first_name|title }}!</strong>
        </div>

        <ul class="nav flex-column">

            <li class="nav-item mb-1">
                <a class="nav-link text-white {% if request.resolver_match.url_name == 'home' %}active{% endif %}"
                   href="{% url 'home' %}">
                    <i class="fas fa-tachometer-alt me-2"></i> Dashboard
                </a>
            </li>

            <li class="nav-item mb-1">
                <a class="nav-link text-white {% if request.resolver_match.url_name == 'clientes_list' %}active{% endif %}"
                   href="{% url 'clientes_list' %}">
                    <i class="fas fa-users me-2"></i> Clientes
                </a>
            </li>

            <li class="nav-item mb-1">
                <a class="nav-link text-white {% if request.resolver_match.url_name == 'pedidos_list' %}active{% endif %}"
                   href="{% url 'pedidos_list' %}">
                    <i class="fas fa-clipboard-list me-2"></i> Pedidos
                </a>
            </li>

            <li class="nav-item mb-1">
                <a class="nav-link text-white {% if request.resolver_match.url_name == 'presupuestos_list' %}active{% endif %}"
                   href="{% url 'presupuestos_list' %}">
                    <i class="fas fa-file-invoice-dollar me-2"></i> Presupuestos
                </a>
            </li>

            <li class="nav-item mb-1">
                <a class="nav-link text-white {% if request.resolver_match.url_name == 'productos_list' %}active{% endif %}"
                   href="{% url 'productos_list' %}">
                    <i class="fas fa-boxes me-2"></i> Productos
                </a>
            </li>

            <li class="nav-item mb-1">
                <a class="nav-link text-white {% if request.resolver_match.url_name == 'compras_list' %}active{% endif %}"
                   href="{% url 'compras_list' %}">
                    <i class="fa-solid fa-cart-shopping me-2"></i> Compras
                </a>
            </li>

            <li class="nav-item mb-1">
                <a class="nav-link text-white {% if request.resolver_match.url_name == 'insumos_list' %}active{% endif %}"
                   href="{% url 'insumos_list' %}">
                    <i class="fas fa-box me-2"></i> Stock de insumos
                </a>
            </li>

            <li class="nav-item mb-1">
                <span class="nav-link text-white">
                    <i class="fas fa-cash-register fa-sm me-2"></i> Caja
                </span>

                <div id="submenuCajaSimple" style="margin-left: 12px;">

                    <ul class="nav flex-column">

                        <li class="nav-item submenu-item">
                            <a class="nav-link text-white {% if request.resolver_match.url_name == 'cajas_list' %}active{% endif %}"
                               href="{% url 'cajas_list' %}">
                                <i class="fa-solid fa-folder-open fa-xs me-2"></i> Gestión de Caja
                            </a>
                        </li>

                        <li class="nav-item submenu-item">
                            <a class="nav-link text-white {% if request.resolver_match.url_name == 'movimientos_list' %}active{% endif %}"
                               href="{% url 'movimientos_list' %}">
                                <i class="fa-solid fa-money-bill-transfer fa-xs me-2"></i> Movimientos
                            </a>
                        </li>

                        <li class="nav-item submenu-item">
                            <a class="nav-link text-white {% if request.resolver_match.url_name == 'formas_pago_list' %}active{% endif %}"
                               href="{% url 'formas_pago_list' %}">
                                <i class="fa-solid fa-credit-card fa-xs me-2"></i> Formas de Pago
                            </a>
                        </li>

                    </ul>
                </div>
            </li>

            <li class="nav-item mb-1">
                <a class="nav-link text-white {% if request.resolver_match.url_name == 'proveedores_list' %}active{% endif %}"
                   href="{% url 'proveedores_list' %}">
                    <i class="fas fa-truck-moving me-2"></i> Proveedores
                </a>
            </li>

            {% if "Jefe" in request.user.groups.all|join:", " %}
            <li class="nav-item mb-1">
                <a class="nav-link text-white {% if request.resolver_match.url_name == 'empleados_list' %}active{% endif %}"
                href="{% url 'empleados_list' %}">
                    <i class="fas fa-user-tie me-2"></i> Empleados
                </a>
            </li>
            {% endif %}

            <li class="nav-item mb-1">
                <a class="nav-link text-white {% if request.resolver_match.url_name == 'configuracion' %}active{% endif %}"
                href="{% url 'configuracion' %}">
                    <i class="fas fa-cogs me-2"></i> Configuración
                </a>
            </li>


        </ul>
    </div>

    <div class="mt-3">
        <form action="{% url 'logout' %}" method="post">
            {% csrf_token %}
            <button type="submit" class="btn btn-danger w-100 btn-sm">
                <i class="fas fa-sign-out-alt me-2"></i> Cerrar sesión
            </button>
        </form>
    </div>

</nav>
{% endif %}

<main class="main-content flex-grow-1">
    {% block content %}{% endblock %}
</main>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
document.addEventListener("DOMContentLoaded", function () {
    const toastElList = document.querySelectorAll('.toast');
    toastElList.forEach((toastEl) => new bootstrap.Toast(toastEl).show());
});
</script>

</body>
</html>

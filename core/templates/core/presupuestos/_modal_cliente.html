<div class="modal fade" id="modalCliente" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content" style="background-color:#1f1f1f; border:1px solid #333;">
      
      <div class="modal-header">
        <h5 class="modal-title text-white">Registrar Cliente</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">

        <form id="formClienteModal">
          {% csrf_token %}

          <input type="text" name="nombre" class="form-control mb-2"
                 placeholder="Nombre" required>

          <input type="text" name="apellido" class="form-control mb-2"
                 placeholder="Apellido">

          <!-- DNI solo números 7–10 dígitos -->
          <input type="text" name="dni" class="form-control mb-2"
                 placeholder="DNI"
                 inputmode="numeric"
                 pattern="[0-9]{7,10}"
                 title="Solo números, entre 7 y 10 dígitos">

          <!-- Email con formato válido -->
          <input type="email" name="email" class="form-control mb-2"
                 placeholder="E-mail"
                 pattern="^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$"
                 title="Debe ingresar un e-mail válido">

          <!-- Teléfono solo números 6–15 dígitos -->
          <input type="text" name="telefono" class="form-control mb-2"
                 placeholder="Teléfono"
                 inputmode="numeric"
                 pattern="[0-9]{6,15}"
                 title="Solo números, entre 6 y 15 dígitos">

          <input type="text" name="direccion" class="form-control mb-2"
                 placeholder="Dirección">
        </form>

      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        <button type="button" id="btnGuardarCliente" class="btn btn-success">Guardar</button>
      </div>

    </div>
  </div>
</div>

<script>
document.getElementById("btnGuardarCliente").addEventListener("click", () => {

    const form = document.getElementById("formClienteModal");

    // VALIDACIONES HTML5
    if (!form.checkValidity()) {
        form.reportValidity(); // Muestra los mensajes de cada input automáticamente
        return;
    }

    const data = new FormData(form);

    fetch("/clientes/create/ajax/", {
        method: "POST",
        headers: {
            "X-CSRFToken": data.get("csrfmiddlewaretoken")
        },
        body: data
    })
    .then(r => r.json())
    .then(data => {

        if (!data.success) {
            alert(data.message);
            return;
        }

        const select = document.getElementById("id_id_cliente");

        const option = new Option(
            data.nombre_completo,
            data.id,
            true,
            true
        );

        select.add(option);

        const modal = bootstrap.Modal.getInstance(
            document.getElementById("modalCliente")
        );
        modal.hide();

        form.reset();
    })
    .catch(err => {
        console.error("Error AJAX:", err);
        alert("Error al registrar el cliente.");
    });

});
</script>
